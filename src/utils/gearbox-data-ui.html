<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ËàπÁî®ÈΩøËΩÆÁÆ±Êï∞ÊçÆÊõ¥Êñ∞Â∑•ÂÖ∑</title>
  <style>
    :root {
      --primary-color: #2c6ea5;
      --primary-hover: #1c5a8f;
      --secondary-color: #607d8b;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
      --light-gray: #f5f5f5;
      --border-color: #ddd;
      --text-color: #333;
      --radius: 4px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Microsoft YaHei', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: #f9f9f9;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
      margin-bottom: 30px;
      text-align: center;
    }
    
    h1, h2, h3 {
      font-weight: 500;
    }
    
    header h1 {
      margin-bottom: 5px;
    }
    
    header p {
      opacity: 0.8;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .card {
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 25px;
    }
    
    .card-title {
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: var(--primary-color);
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
    }
    
    .card-title .icon {
      margin-right: 10px;
      font-size: 1.2em;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .file-input-group {
      display: flex;
    }
    
    .file-input-group input[type="text"] {
      flex: 1;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-right: none;
    }
    
    .file-input-group .btn-browse {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    
    input[type="text"],
    input[type="file"],
    textarea,
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background-color: white;
      font-family: inherit;
      font-size: 1rem;
    }
    
    input[type="file"] {
      padding: 8px;
    }
    
    textarea {
      min-height: 200px;
      resize: vertical;
      font-family: monospace;
      font-size: 0.9rem;
    }
    
    .textarea-container {
      position: relative;
    }
    
    .textarea-actions {
      position: absolute;
      top: 5px;
      right: 5px;
      display: flex;
      gap: 5px;
    }
    
    .textarea-actions button {
      padding: 5px;
      background-color: rgba(255, 255, 255, 0.8);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      cursor: pointer;
    }
    
    .textarea-actions button:hover {
      background-color: var(--light-gray);
    }
    
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      text-align: center;
      transition: background-color 0.2s, transform 0.1s;
    }
    
    .btn:hover {
      background-color: var(--primary-hover);
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-warning {
      background-color: var(--warning-color);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .alert {
      padding: 15px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }
    
    .alert .icon {
      margin-right: 10px;
      font-size: 1.2em;
    }
    
    .alert-success {
      background-color: rgba(76, 175, 80, 0.1);
      border: 1px solid var(--success-color);
      color: var(--success-color);
    }
    
    .alert-warning {
      background-color: rgba(255, 152, 0, 0.1);
      border: 1px solid var(--warning-color);
      color: var(--warning-color);
    }
    
    .alert-danger {
      background-color: rgba(244, 67, 54, 0.1);
      border: 1px solid var(--danger-color);
      color: var(--danger-color);
    }
    
    .progress {
      height: 10px;
      background-color: var(--light-gray);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 5px;
    }
    
    .progress-bar {
      height: 100%;
      background-color: var(--primary-color);
      width: 0;
      transition: width 0.3s;
    }
    
    .tabs {
      display: flex;
      list-style: none;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    
    .tab-item {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: var(--radius) var(--radius) 0 0;
      margin-right: 5px;
      margin-bottom: -1px;
      background-color: var(--light-gray);
      transition: all 0.2s;
    }
    
    .tab-item.active {
      background-color: white;
      border-color: var(--border-color);
      position: relative;
    }
    
    .tab-item.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 1px;
      background-color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .data-summary {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .summary-card {
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 15px;
      border-left: 4px solid var(--primary-color);
    }
    
    .summary-card h4 {
      margin-top: 0;
      margin-bottom: 5px;
      color: var(--primary-color);
    }
    
    .summary-card .count {
      font-size: 24px;
      font-weight: bold;
    }
    
    .summary-card .count-changed {
      color: var(--warning-color);
      font-weight: bold;
    }
    
    .summary-card p {
      margin: 5px 0 0;
      font-size: 0.9rem;
      color: var(--secondary-color);
    }
    
    .table-responsive {
      overflow-x: auto;
      margin-top: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    table th, table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    table th {
      background-color: var(--light-gray);
      font-weight: 500;
    }
    
    table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    
    table tr:hover {
      background-color: #f1f1f1;
    }
    
    .changed {
      background-color: rgba(255, 152, 0, 0.1);
    }
    
    .added {
      background-color: rgba(76, 175, 80, 0.1);
    }
    
    .footer {
      text-align: center;
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      color: var(--secondary-color);
    }
    
    @media (max-width: 768px) {
      .data-summary {
        grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
    
    /* Âä†ËΩΩÂä®Áîª */
    .loader {
      display: none;
      text-align: center;
      padding: 30px 0;
    }
    
    .loader-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>ËàπÁî®ÈΩøËΩÆÁÆ±Êï∞ÊçÆÊõ¥Êñ∞Â∑•ÂÖ∑</h1>
      <p>Â∞ÜÈΩøËΩÆÁÆ±‰ª∑Ê†ºË°®Êï∞ÊçÆÂØºÂÖ•Âπ∂Êõ¥Êñ∞Âà∞Á≥ªÁªü‰∏≠</p>
    </div>
  </header>
  
  <div class="container">
    <div id="alerts"></div>
    
    <div class="card">
      <h2 class="card-title">
        <span class="icon">üìÅ</span>Êï∞ÊçÆÂØºÂÖ•
      </h2>
      
      <ul class="tabs">
        <li class="tab-item active" data-tab="file">Êñá‰ª∂ÂØºÂÖ•</li>
        <li class="tab-item" data-tab="text">ÊñáÊú¨ÂØºÂÖ•</li>
      </ul>
      
      <div class="tab-content active" id="file-tab">
        <div class="form-group">
          <label for="target-file">ÁõÆÊ†áÊñá‰ª∂ (Áé∞ÊúâÁ≥ªÁªüÊï∞ÊçÆ):</label>
          <div class="file-input-group">
            <input type="text" id="target-file-path" placeholder="ÈÄâÊã©ÊàñËæìÂÖ•Êñá‰ª∂Ë∑ØÂæÑ" readonly>
            <button class="btn btn-browse" id="target-file-browse">ÊµèËßà</button>
            <input type="file" id="target-file" accept=".js" style="display: none;">
          </div>
        </div>
        
        <div class="form-group">
          <label for="source-file">Ê∫êÊñá‰ª∂ (Êñ∞ÁöÑ‰ª∑Ê†ºÊï∞ÊçÆ):</label>
          <div class="file-input-group">
            <input type="text" id="source-file-path" placeholder="ÈÄâÊã©ÊàñËæìÂÖ•Êñá‰ª∂Ë∑ØÂæÑ" readonly>
            <button class="btn btn-browse" id="source-file-browse">ÊµèËßà</button>
            <input type="file" id="source-file" accept=".js,.txt" style="display: none;">
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn" id="import-file-btn">ÂØºÂÖ•Êï∞ÊçÆ</button>
          <button class="btn btn-secondary" id="reset-file-btn">ÈáçÁΩÆ</button>
        </div>
      </div>
      
      <div class="tab-content" id="text-tab">
        <div class="form-group">
          <label for="target-text">ÁõÆÊ†áÊñáÊú¨ (Áé∞ÊúâÁ≥ªÁªüÊï∞ÊçÆ):</label>
          <div class="textarea-container">
            <textarea id="target-text" placeholder="Á≤òË¥¥Áé∞ÊúâÁöÑ embeddedData.js ÂÜÖÂÆπ"></textarea>
            <div class="textarea-actions">
              <button title="Ê∏ÖÁ©∫" id="clear-target-text">üóëÔ∏è</button>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="source-text">Ê∫êÊñáÊú¨ (Êñ∞ÁöÑ‰ª∑Ê†ºÊï∞ÊçÆ):</label>
          <div class="textarea-container">
            <textarea id="source-text" placeholder="Á≤òË¥¥Êñ∞ÁöÑ embeddednew.js ÂÜÖÂÆπÊàñ OCR Â§ÑÁêÜÂêéÁöÑ‰ª∑Ê†ºË°®"></textarea>
            <div class="textarea-actions">
              <button title="Ê∏ÖÁ©∫" id="clear-source-text">üóëÔ∏è</button>
            </div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn" id="import-text-btn">ÂØºÂÖ•Êï∞ÊçÆ</button>
          <button class="btn btn-secondary" id="reset-text-btn">ÈáçÁΩÆ</button>
        </div>
      </div>
    </div>
    
    <div class="card" id="result-card" style="display: none;">
      <h2 class="card-title">
        <span class="icon">üìä</span>Êï∞ÊçÆÂêàÂπ∂ÁªìÊûú
      </h2>
      
      <div id="data-summary" class="data-summary">
        <!-- Êï∞ÊçÆÊëòË¶ÅÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
      </div>
      
      <div class="form-group">
        <label for="merged-code">ÂêàÂπ∂ÂêéÁöÑ‰ª£Á†Å:</label>
        <div class="textarea-container">
          <textarea id="merged-code" readonly></textarea>
          <div class="textarea-actions">
            <button title="Â§çÂà∂" id="copy-merged-code">üìã</button>
            <button title="‰∏ãËΩΩ" id="download-merged-code">üíæ</button>
          </div>
        </div>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-success" id="apply-btn">Â∫îÁî®Âà∞Á≥ªÁªü</button>
        <button class="btn btn-secondary" id="back-btn">ËøîÂõûÁºñËæë</button>
      </div>
    </div>
    
    <div class="loader" id="loader">
      <div class="loader-spinner"></div>
      <p>Ê≠£Âú®Â§ÑÁêÜÊï∞ÊçÆÔºåËØ∑Á®çÂÄô...</p>
    </div>
    
    <div class="footer">
      <p>ËàπÁî®ÈΩøËΩÆÁÆ±ÈÄâÂûãÁ≥ªÁªü &copy; 2025 - Êï∞ÊçÆÊõ¥Êñ∞Â∑•ÂÖ∑</p>
    </div>
  </div>

  <script>
    // Â∑•ÂÖ∑ÂáΩÊï∞ - ‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠ÊèêÂèñJavaScriptÂØπË±°
    function extractObjectFromString(content, objectName) {
      try {
        // ÂØªÊâæÂØπË±°ÂÆö‰πâÁöÑËµ∑Âßã‰ΩçÁΩÆ
        const startPattern = new RegExp(`(export\\s+)?const\\s+${objectName}\\s*=\\s*\\{`);
        const match = content.match(startPattern);
        
        if (!match) {
          console.error(`Êâæ‰∏çÂà∞ÂØπË±°ÂÆö‰πâ: ${objectName}`);
          return null;
        }
        
        const startPos = match.index;
        let braceCount = 1;
        let endPos = startPos + match[0].length;
        
        // Êü•ÊâæÂåπÈÖçÁöÑÂ§ßÊã¨Âè∑‰ª•Á°ÆÂÆöÂØπË±°ÁªìÊùü‰ΩçÁΩÆ
        while (braceCount > 0 && endPos < content.length) {
          const char = content[endPos];
          if (char === '{') braceCount++;
          else if (char === '}') braceCount--;
          endPos++;
        }
        
        if (braceCount !== 0) {
          console.error('Êó†Ê≥ïÊâæÂà∞ÂØπË±°ÁöÑÁªìÊùü‰ΩçÁΩÆ');
          return null;
        }
        
        // ÊèêÂèñÂÆåÊï¥ÁöÑÂØπË±°ÂÆö‰πâ
        const objectCode = content.substring(startPos, endPos);
        
        // ÂáÜÂ§áÊâßË°å‰ª£Á†Å - Â∞ÜexportÊõøÊç¢‰∏∫letÔºå‰ª•‰æøÂú®ÂáΩÊï∞‰∏≠‰ΩøÁî®
        const execCode = objectCode.replace(/export\s+const/, 'const');
        
        // ‰ΩøÁî®FunctionÊûÑÈÄ†Âô®ÊâßË°å‰ª£Á†ÅÂπ∂ËøîÂõûÂØπË±°
        const extractFn = new Function(`
          ${execCode}
          return ${objectName};
        `);
        
        return extractFn();
      } catch (error) {
        console.error('‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠ÊèêÂèñÂØπË±°Êó∂Âá∫Èîô:', error);
        return null;
      }
    }

    // Â∑•ÂÖ∑ÂáΩÊï∞ - ÂêàÂπ∂ÈΩøËΩÆÁÆ±Êï∞ÊçÆ
    function mergeGearboxData(targetData, sourceData) {
      if (!targetData) return sourceData;
      if (!sourceData) return targetData;
      
      // ÂàõÂª∫ÁõÆÊ†áÊï∞ÊçÆÁöÑÊ∑±Êã∑Ë¥ù
      const result = JSON.parse(JSON.stringify(targetData));
      
      // Ë∑üË∏™Êõ¥Êîπ
      const changes = {
        updated: [],
        added: [],
        categories: {}
      };
      
      // Êõ¥Êñ∞ÂÖÉÊï∞ÊçÆ
      if (sourceData._version) result._version = sourceData._version;
      if (sourceData._lastFixed) result._lastFixed = sourceData._lastFixed;
      
      // Â§ÑÁêÜÊØè‰∏™ÈΩøËΩÆÁÆ±Á±ªÂà´ (hcGearboxes, gwGearboxes, etc.)
      Object.keys(sourceData).forEach(category => {
        // Ë∑≥ËøáÈùûÊï∞ÁªÑÂ±ûÊÄß
        if (!Array.isArray(sourceData[category])) {
          if (!['_version', '_lastFixed'].includes(category)) {
            result[category] = sourceData[category];
          }
          return;
        }
        
        // Á°Æ‰øùÁõÆÊ†á‰∏≠ÊúâÁõ∏Â∫îÁ±ªÂà´Êï∞ÁªÑ
        if (!Array.isArray(result[category])) {
          result[category] = [];
        }
        
        // ÂàùÂßãÂåñÁ±ªÂà´Êõ¥ÊîπËÆ°Êï∞
        changes.categories[category] = {
          total: result[category].length,
          updated: 0,
          added: 0
        };
        
        // ‰∏∫ÁõÆÊ†áÁ±ªÂà´ÂàõÂª∫ÂûãÂè∑Êò†Â∞ÑÔºå‰æø‰∫éÂø´ÈÄüÊü•Êâæ
        const modelMap = new Map(
          result[category].map(item => [item.model, item])
        );
        
        // Â§ÑÁêÜÊ∫êÊï∞ÊçÆ‰∏≠ÁöÑÊØè‰∏ÄÈ°π
        sourceData[category].forEach(sourceItem => {
          if (!sourceItem.model) return; // Ë∑≥ËøáÊó†ÊïàÈ°π
          
          const existingItem = modelMap.get(sourceItem.model);
          
          if (existingItem) {
            // Êõ¥Êñ∞Áé∞ÊúâÈ°π
            let isUpdated = false;
            
            Object.keys(sourceItem).forEach(key => {
              // ÂØπ‰∫é‰ª∑Ê†ºÁõ∏ÂÖ≥Â≠óÊÆµÔºå‰ºòÂÖà‰ΩøÁî®Ê∫êÊï∞ÊçÆ
              if (['basePrice', 'price', 'discountRate', 'factoryPrice', 
                   'packagePrice', 'marketPrice', 'notes'].includes(key)) {
                if (existingItem[key] !== sourceItem[key]) {
                  existingItem[key] = sourceItem[key];
                  isUpdated = true;
                }
              }
              // ÂØπ‰∫éÂÖ∂‰ªñÂÖ≥ÈîÆÊäÄÊúØÂèÇÊï∞ÔºåÂΩìÁé∞ÊúâÊï∞ÊçÆÂ≠óÊÆµ‰∏∫Á©∫Êàñ0Êó∂Êõ¥Êñ∞
              else if (existingItem[key] === null || existingItem[key] === undefined || 
                      existingItem[key] === 0 || existingItem[key] === '' || 
                      existingItem[key] === '-') {
                existingItem[key] = sourceItem[key];
                isUpdated = true;
              }
            });
            
            if (isUpdated) {
              changes.updated.push({
                category,
                model: sourceItem.model
              });
              changes.categories[category].updated++;
            }
          } else {
            // Ê∑ªÂä†Êñ∞È°π
            result[category].push(JSON.parse(JSON.stringify(sourceItem)));
            modelMap.set(sourceItem.model, result[category][result[category].length - 1]);
            
            changes.added.push({
              category,
              model: sourceItem.model
            });
            changes.categories[category].added++;
          }
        });
        
        // Êõ¥Êñ∞ÊÄªÊï∞
        changes.categories[category].total = result[category].length;
      });
      
      return { data: result, changes };
    }

    // Â∑•ÂÖ∑ÂáΩÊï∞ - Â∞ÜÊï∞ÊçÆÂØπË±°ËΩ¨Êç¢‰∏∫JavaScript‰ª£Á†ÅÂ≠óÁ¨¶‰∏≤
    function convertToJsCode(data, includeFunction = true) {
      const now = new Date();
      const dateStr = now.toISOString().split('T')[0];
      
      let code = `// src/data/embeddedData.js
// ËàπÁî®ÈΩøËΩÆÁÆ±ÂÜÖÁΩÆÊï∞ÊçÆ - Ëá™Âä®Êõ¥Êñ∞‰∫é ${dateStr}
// Êï∞ÊçÆÊù•Ê∫êÔºö
// - OCR‰ª∑Ê†ºË°®ÂèäÂÖ∂‰ªñÊõ¥Êñ∞Êù•Ê∫ê
// - embeddednew.js‰ª∑Ê†ºÂèäÂèÇÊï∞Êï∞ÊçÆ
//
// Êõ¥Êñ∞ÈÄªËæëÔºö
// - ‰øùÁïôÁé∞ÊúâÊï∞ÊçÆÁªìÊûÑÂíåÈùû‰ª∑Ê†ºÂèÇÊï∞Â≠óÊÆµ
// - ‰∏ìÊ≥®‰∫éÊõ¥Êñ∞‰ª∑Ê†ºÁõ∏ÂÖ≥Â≠óÊÆµ(basePrice, price, discountRate, factoryPrice, packagePrice, marketPrice)
// - ÂΩìÁé∞ÊúâÊäÄÊúØÂèÇÊï∞Â≠óÊÆµ‰∏∫Á©∫Êàñ0Êó∂Ôºå‰ΩøÁî®Êñ∞Êï∞ÊçÆÊõøÊç¢

/**
 * ÂµåÂÖ•ÂºèÈΩøËΩÆÁÆ±Êï∞ÊçÆÈõÜ
 * key ‰∏∫ÂàÜÁ±ªÔºåvalue ‰∏∫ÂØπÂ∫îÊï∞ÁªÑ
 */
export const embeddedGearboxData = ${JSON.stringify(data, null, 2)};
`;

      if (includeFunction) {
        code += `

/**
 * Ê†πÊçÆÂ§ñÈÉ®‰ª∑Ê†ºË°®Êõ¥Êñ∞ÈΩøËΩÆÁÆ±‰ª∑Ê†º
 * @param {object} data ÂµåÂÖ•ÂºèÊï∞ÊçÆ
 * @param {Array<{model:string,basePrice:number,discountRate:number,discountedPrice:number}>} priceList Â§ñÈÉ®‰ª∑Ê†ºÂàóË°®
 * @returns {object} Êõ¥Êñ∞ÂêéÁöÑÊï∞ÊçÆ
 */
export function applyPriceUpdates(data, priceList) {
  const priceMap = new Map();
  priceList.forEach((item) => {
    const key = item.model.trim();
    priceMap.set(key, item);
  });

  const updated = JSON.parse(JSON.stringify(data));
  Object.values(updated).forEach((arr) => {
    if (!Array.isArray(arr)) return;
    arr.forEach((g) => {
      const p = priceMap.get(g.model);
      if (p) {
        g.basePrice = p.basePrice;
        g.price = p.basePrice;
        g.discountRate = p.discountRate;
        g.factoryPrice = p.discountedPrice;
        g.packagePrice = p.discountedPrice;
        g.marketPrice = g.factoryPrice
          ? parseFloat((g.factoryPrice / (1 - 0.12)).toFixed(2))
          : 0;
        g.priceWarning = false;
      }
    });
  });
  return updated;
}`;
      }
      
      return code;
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - Ëé∑ÂèñÁ±ªÂà´ÊòæÁ§∫ÂêçÁß∞
    function getCategoryDisplayName(category) {
      const displayNames = {
        'hcGearboxes': 'HCÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'gwGearboxes': 'GWÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'gcGearboxes': 'GCÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'dtGearboxes': 'DTÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'hcqGearboxes': 'HCQÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'hcmGearboxes': 'HCMÁ≥ªÂàóÈΩøËΩÆÁÆ±',
        'standbyPumps': 'Â§áÁî®Ê≥µ',
        'flexibleCouplings': 'È´òÂºπÊÄßËÅîËΩ¥Âô®',
        'clutches': 'Á¶ªÂêàÂô®'
      };
      
      return displayNames[category] || category;
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
    function showAlert(type, message) {
      const alertsContainer = document.getElementById('alerts');
      const alertElement = document.createElement('div');
      alertElement.className = `alert alert-${type}`;
      
      let icon = '‚ùì';
      if (type === 'success') icon = '‚úÖ';
      if (type === 'warning') icon = '‚ö†Ô∏è';
      if (type === 'danger') icon = '‚ùå';
      
      alertElement.innerHTML = `
        <span class="icon">${icon}</span>
        <div>${message}</div>
      `;
      
      alertsContainer.appendChild(alertElement);
      
      // Ëá™Âä®ÂÖ≥Èó≠ÔºàÊàêÂäüÂíåË≠¶ÂëäÊèêÁ§∫Ôºâ
      if (type === 'success' || type === 'warning') {
        setTimeout(() => {
          alertElement.remove();
        }, 5000);
      }
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - Ê∏ÖÈô§ÊâÄÊúâÊèêÁ§∫‰ø°ÊÅØ
    function clearAlerts() {
      const alertsContainer = document.getElementById('alerts');
      alertsContainer.innerHTML = '';
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - ÊòæÁ§∫/ÈöêËóèÂä†ËΩΩÂä®Áîª
    function toggleLoader(show) {
      const loader = document.getElementById('loader');
      loader.style.display = show ? 'block' : 'none';
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - ‰∏ãËΩΩÊñáÊú¨‰∏∫Êñá‰ª∂
    function downloadTextAsFile(text, filename) {
      const blob = new Blob([text], { type: 'text/javascript' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - Â§çÂà∂ÊñáÊú¨Âà∞Ââ™Ë¥¥Êùø
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showAlert('success', 'Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
      }).catch(err => {
        console.error('Â§çÂà∂Â§±Ë¥•:', err);
        showAlert('danger', 'Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
      });
    }
    
    // Â∑•ÂÖ∑ÂáΩÊï∞ - Êõ¥Êñ∞Êï∞ÊçÆÊëòË¶ÅÊòæÁ§∫
    function updateDataSummary(changes) {
      const summaryContainer = document.getElementById('data-summary');
      summaryContainer.innerHTML = '';
      
      Object.keys(changes.categories).forEach(category => {
        const data = changes.categories[category];
        const displayName = getCategoryDisplayName(category);
        
        const card = document.createElement('div');
        card.className = 'summary-card';
        
        let hasChanges = data.updated > 0 || data.added > 0;
        
        card.innerHTML = `
          <h4>${displayName}</h4>
          <div class="count ${hasChanges ? 'count-changed' : ''}">
            ${data.total} È°π
          </div>
          <p>
            ${data.updated > 0 ? `Êõ¥Êñ∞: <strong>${data.updated}</strong>` : ''}
            ${data.updated > 0 && data.added > 0 ? ' | ' : ''}
            ${data.added > 0 ? `Êñ∞Â¢û: <strong>${data.added}</strong>` : ''}
            ${data.updated === 0 && data.added === 0 ? 'Êó†ÂèòÊõ¥' : ''}
          </p>
        `;
        
        summaryContainer.appendChild(card);
      });
    }
    
    // ‰∏ªÂáΩÊï∞ - Â§ÑÁêÜÊï∞ÊçÆÂêàÂπ∂
    function processDataMerge(targetContent, sourceContent) {
      clearAlerts();
      toggleLoader(true);
      
      setTimeout(() => {
        try {
          // Â∞ùËØï‰ªéÁõÆÊ†áÂÜÖÂÆπ‰∏≠ÊèêÂèñÊï∞ÊçÆ
          const targetData = extractObjectFromString(targetContent, 'embeddedGearboxData');
          
          if (!targetData) {
            showAlert('danger', 'Êó†Ê≥ï‰ªéÁõÆÊ†áÂÜÖÂÆπ‰∏≠ÊèêÂèñ embeddedGearboxData ÂØπË±°„ÄÇËØ∑Á°Æ‰øùÂÜÖÂÆπÊ†ºÂºèÊ≠£Á°Æ„ÄÇ');
            toggleLoader(false);
            return;
          }
          
          // Â∞ùËØï‰ªéÊ∫êÂÜÖÂÆπ‰∏≠ÊèêÂèñÊï∞ÊçÆ
          const sourceData = extractObjectFromString(sourceContent, 'embeddedGearboxData');
          
          if (!sourceData) {
            showAlert('danger', 'Êó†Ê≥ï‰ªéÊ∫êÂÜÖÂÆπ‰∏≠ÊèêÂèñ embeddedGearboxData ÂØπË±°„ÄÇËØ∑Á°Æ‰øùÂÜÖÂÆπÊ†ºÂºèÊ≠£Á°Æ„ÄÇ');
            toggleLoader(false);
            return;
          }
          
          // ÂêàÂπ∂Êï∞ÊçÆ
          const { data: mergedData, changes } = mergeGearboxData(targetData, sourceData);
          
          // Â∞ÜÂêàÂπ∂ÂêéÁöÑÊï∞ÊçÆËΩ¨Êç¢‰∏∫‰ª£Á†Å
          const mergedCode = convertToJsCode(mergedData);
          
          // ÊòæÁ§∫ÂêàÂπ∂ÁªìÊûú
          document.getElementById('merged-code').value = mergedCode;
          updateDataSummary(changes);
          
          // ÈöêËóèÊï∞ÊçÆÂØºÂÖ•Âç°ÁâáÔºåÊòæÁ§∫ÁªìÊûúÂç°Áâá
          document.getElementById('result-card').style.display = 'block';
          
          // ÊªöÂä®Âà∞ÁªìÊûúÂç°Áâá
          document.getElementById('result-card').scrollIntoView({ behavior: 'smooth' });
          
          showAlert('success', `Êï∞ÊçÆÂêàÂπ∂ÊàêÂäüÔºÅÂÖ±Êõ¥Êñ∞‰∫Ü ${changes.updated.length} È°πÔºåÊñ∞Â¢û‰∫Ü ${changes.added.length} È°π„ÄÇ`);
        } catch (error) {
          console.error('Â§ÑÁêÜÊï∞ÊçÆÊó∂Âá∫Èîô:', error);
          showAlert('danger', `Â§ÑÁêÜÊï∞ÊçÆÊó∂Âá∫Èîô: ${error.message}`);
        } finally {
          toggleLoader(false);
        }
      }, 500); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºå‰ΩøÂä†ËΩΩÂä®ÁîªÂèØËßÅ
    }
    
    // DOMÂä†ËΩΩÂÆåÊàêÂêéÊâßË°å
    document.addEventListener('DOMContentLoaded', () => {
      // Ê†áÁ≠æÂàáÊç¢
      document.querySelectorAll('.tab-item').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          
          // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
          document.querySelectorAll('.tab-item').forEach(t => {
            t.classList.toggle('active', t === tab);
          });
          
          // Êõ¥Êñ∞ÂÜÖÂÆπÁä∂ÊÄÅ
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.toggle('active', content.id === `${tabId}-tab`);
          });
        });
      });
      
      // Êñá‰ª∂ÊµèËßàÊåâÈíÆ
      document.getElementById('target-file-browse').addEventListener('click', () => {
        document.getElementById('target-file').click();
      });
      
      document.getElementById('source-file-browse').addEventListener('click', () => {
        document.getElementById('source-file').click();
      });
      
      // Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂
      document.getElementById('target-file').addEventListener('change', event => {
        const file = event.target.files[0];
        if (file) {
          document.getElementById('target-file-path').value = file.name;
        }
      });
      
      document.getElementById('source-file').addEventListener('change', event => {
        const file = event.target.files[0];
        if (file) {
          document.getElementById('source-file-path').value = file.name;
        }
      });
      
      // ÊñáÊú¨Ê∏ÖÁ©∫ÊåâÈíÆ
      document.getElementById('clear-target-text').addEventListener('click', () => {
        document.getElementById('target-text').value = '';
      });
      
      document.getElementById('clear-source-text').addEventListener('click', () => {
        document.getElementById('source-text').value = '';
      });
      
      // Êñá‰ª∂ÂØºÂÖ•ÊåâÈíÆ
      document.getElementById('import-file-btn').addEventListener('click', () => {
        const targetFile = document.getElementById('target-file').files[0];
        const sourceFile = document.getElementById('source-file').files[0];
        
        if (!targetFile) {
          showAlert('warning', 'ËØ∑ÈÄâÊã©ÁõÆÊ†áÊñá‰ª∂');
          return;
        }
        
        if (!sourceFile) {
          showAlert('warning', 'ËØ∑ÈÄâÊã©Ê∫êÊñá‰ª∂');
          return;
        }
        
        // ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ
        const targetReader = new FileReader();
        const sourceReader = new FileReader();
        
        targetReader.onload = targetEvent => {
          const targetContent = targetEvent.target.result;
          
          sourceReader.onload = sourceEvent => {
            const sourceContent = sourceEvent.target.result;
            
            // Â§ÑÁêÜÊï∞ÊçÆÂêàÂπ∂
            processDataMerge(targetContent, sourceContent);
          };
          
          sourceReader.onerror = () => {
            showAlert('danger', 'ËØªÂèñÊ∫êÊñá‰ª∂Â§±Ë¥•');
          };
          
          sourceReader.readAsText(sourceFile);
        };
        
        targetReader.onerror = () => {
          showAlert('danger', 'ËØªÂèñÁõÆÊ†áÊñá‰ª∂Â§±Ë¥•');
        };
        
        targetReader.readAsText(targetFile);
      });
      
      // Êñá‰ª∂ÈáçÁΩÆÊåâÈíÆ
      document.getElementById('reset-file-btn').addEventListener('click', () => {
        document.getElementById('target-file').value = '';
        document.getElementById('source-file').value = '';
        document.getElementById('target-file-path').value = '';
        document.getElementById('source-file-path').value = '';
        clearAlerts();
      });
      
      // ÊñáÊú¨ÂØºÂÖ•ÊåâÈíÆ
      document.getElementById('import-text-btn').addEventListener('click', () => {
        const targetContent = document.getElementById('target-text').value;
        const sourceContent = document.getElementById('source-text').value;
        
        if (!targetContent) {
          showAlert('warning', 'ËØ∑ËæìÂÖ•ÁõÆÊ†áÊñáÊú¨');
          return;
        }
        
        if (!sourceContent) {
          showAlert('warning', 'ËØ∑ËæìÂÖ•Ê∫êÊñáÊú¨');
          return;
        }
        
        // Â§ÑÁêÜÊï∞ÊçÆÂêàÂπ∂
        processDataMerge(targetContent, sourceContent);
      });
      
      // ÊñáÊú¨ÈáçÁΩÆÊåâÈíÆ
      document.getElementById('reset-text-btn').addEventListener('click', () => {
        document.getElementById('target-text').value = '';
        document.getElementById('source-text').value = '';
        clearAlerts();
      });
      
      // Â§çÂà∂ÂêàÂπ∂‰ª£Á†ÅÊåâÈíÆ
      document.getElementById('copy-merged-code').addEventListener('click', () => {
        const mergedCode = document.getElementById('merged-code').value;
        
        if (!mergedCode) {
          showAlert('warning', 'Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑ‰ª£Á†Å');
          return;
        }
        
        copyToClipboard(mergedCode);
      });
      
      // ‰∏ãËΩΩÂêàÂπ∂‰ª£Á†ÅÊåâÈíÆ
      document.getElementById('download-merged-code').addEventListener('click', () => {
        const mergedCode = document.getElementById('merged-code').value;
        
        if (!mergedCode) {
          showAlert('warning', 'Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑ‰ª£Á†Å');
          return;
        }
        
        downloadTextAsFile(mergedCode, 'embeddedData.js');
      });
      
      // Â∫îÁî®ÊåâÈíÆ
      document.getElementById('apply-btn').addEventListener('click', () => {
        showAlert('success', 'Êï∞ÊçÆÂ∑≤ÊàêÂäüÊõ¥Êñ∞ÔºÅËØ∑Â∞ÜÁîüÊàêÁöÑ‰ª£Á†ÅÊõøÊç¢Âà∞Á≥ªÁªü‰∏≠ÁöÑ src/data/embeddedData.js Êñá‰ª∂„ÄÇ');
      });
      
      // ËøîÂõûÁºñËæëÊåâÈíÆ
      document.getElementById('back-btn').addEventListener('click', () => {
        document.getElementById('result-card').style.display = 'none';
        clearAlerts();
      });
    });
  </script>
</body>
</html>
