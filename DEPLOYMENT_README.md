# 齿轮箱选型系统 - 云端部署资源包

本目录包含将改进后的齿轮箱选型系统部署到云端服务器 (47.111.132.236) 的所有必要文件和文档。

---

## 📦 部署资源清单

### 核心文件

| 文件 | 说明 | 用途 |
|-----|------|------|
| `build/` | 生产构建目录 | 包含所有编译后的静态文件 |
| `deploy.sh` | 自动化部署脚本 | 一键部署到服务器 |
| `package.json` | 项目配置文件 | 包含构建和依赖信息 |

### 配置文件

| 文件 | 说明 | 用途 |
|-----|------|------|
| `nginx_gearbox.conf` | Nginx 服务器配置 | 子路径部署配置 |
| `docker-nginx.conf` | Docker Nginx 配置 | 容器化部署配置 |
| `Dockerfile` | Docker 镜像定义 | 容器化构建 |
| `docker-compose.yml` | Docker Compose 配置 | 多容器编排 |

### 集成文件

| 文件 | 说明 | 用途 |
|-----|------|------|
| `dashboard-integration.html` | Dashboard 集成代码 | iframe 嵌入示例 |

### 文档文件

| 文件 | 说明 | 推荐阅读顺序 |
|-----|------|------------|
| `QUICK_START.md` | 快速开始指南 | ⭐ 首先阅读 |
| `DEPLOYMENT_GUIDE.md` | 详细部署文档 | 深入了解各种方案 |
| `DEPLOYMENT_README.md` | 本文件 | 概览 |

---

## 🚀 快速部署（三步走）

### 第一步：准备

```bash
cd /home/user/gearbox-new

# 确保有构建文件
ls build/index.html
# 如果没有，执行: npm run build
```

### 第二步：部署

**方式 A - 自动化脚本（推荐）**
```bash
chmod +x deploy.sh
./deploy.sh
```

**方式 B - 手动部署**
```bash
# 参考 QUICK_START.md 中的手动步骤
```

### 第三步：验证

访问: **http://47.111.132.236/gearbox/**

---

## 📚 详细文档导航

### 新手用户
1. 先读 `QUICK_START.md` - 快速上手
2. 遇到问题查看其中的"故障排查"部分

### 有经验的用户
1. 查看 `DEPLOYMENT_GUIDE.md` 选择合适的部署方案
2. 根据选定方案执行相应步骤

### DevOps 工程师
1. 使用 Docker 方式部署（参考 `DEPLOYMENT_GUIDE.md` 方案四）
2. 配置 CI/CD 流水线
3. 设置监控和日志

---

## 🎯 部署方案对比

| 方案 | 适用场景 | 复杂度 | 推荐度 |
|-----|---------|-------|-------|
| **子路径部署** | 快速上线 | ⭐ | ⭐⭐⭐⭐⭐ |
| **iframe 嵌入** | 深度集成到 Dashboard | ⭐⭐ | ⭐⭐⭐⭐ |
| **反向代理** | 需要独立服务 | ⭐⭐⭐ | ⭐⭐⭐ |
| **Docker** | 容器化环境 | ⭐⭐⭐⭐ | ⭐⭐⭐ |

**推荐**: 使用"子路径部署"快速上线，然后通过"iframe 嵌入"集成到 Dashboard

---

## ✨ 本次更新亮点

### 🔧 修复的问题
- ✅ 技术协议模板选择器闪退问题
- ✅ Props 不匹配导致的错误
- ✅ 数据初始化时序问题
- ✅ 错误处理不完善

### 🎨 新增的改进
- ✅ ErrorBoundary 错误边界保护
- ✅ 更完善的初始化检查
- ✅ 友好的错误提示
- ✅ 降级方案支持

### 📦 部署配置
- ✅ 自动化部署脚本
- ✅ Nginx 配置模板
- ✅ Docker 容器化支持
- ✅ Dashboard 集成示例

---

## 🔄 部署流程图

```
┌─────────────────┐
│  本地开发环境   │
│  (localhost)    │
└────────┬────────┘
         │
         │ npm run build
         ▼
┌─────────────────┐
│  构建生产版本   │
│  (build/)       │
└────────┬────────┘
         │
         │ 选择部署方案
         ├─────────────────┬─────────────────┬─────────────────┐
         │                 │                 │                 │
         ▼                 ▼                 ▼                 ▼
   ┌──────────┐      ┌──────────┐    ┌──────────┐      ┌──────────┐
   │子路径部署│      │ iframe   │    │反向代理  │      │ Docker   │
   │  /gearbox│      │  嵌入    │    │  部署    │      │  容器化  │
   └─────┬────┘      └─────┬────┘    └─────┬────┘      └─────┬────┘
         │                 │                │                 │
         └─────────────────┴────────────────┴─────────────────┘
                                    │
                                    ▼
                       ┌────────────────────────┐
                       │  云端服务器             │
                       │  47.111.132.236        │
                       │  /var/www/html/gearbox │
                       └────────────────────────┘
                                    │
                                    ▼
                       ┌────────────────────────┐
                       │  用户访问               │
                       │  http://47.../gearbox/ │
                       └────────────────────────┘
```

---

## 🛠️ 技术栈

- **前端框架**: React 18
- **UI 框架**: React Bootstrap
- **构建工具**: Create React App
- **Web 服务器**: Nginx (推荐) / Apache
- **容器化**: Docker (可选)

---

## 📊 部署检查清单

### 部署前检查
- [ ] 本地测试通过
- [ ] 代码已提交到 Git
- [ ] 构建文件已生成 (`build/` 目录存在)
- [ ] 服务器 SSH 连接正常
- [ ] 备份现有数据（如果有）

### 部署中检查
- [ ] 文件上传完整
- [ ] 文件权限正确
- [ ] Nginx 配置正确
- [ ] Nginx 测试通过 (`nginx -t`)
- [ ] Nginx 已重启

### 部署后验证
- [ ] 页面可以正常访问
- [ ] 静态资源加载正常
- [ ] 功能测试通过
- [ ] 技术协议模板功能正常
- [ ] 无控制台错误
- [ ] 移动端显示正常

---

## 🚦 部署状态指示

### ✅ 部署成功标志
- HTTP 状态码 200
- 页面正常显示
- 功能操作正常
- 无控制台错误

### ❌ 常见问题
| 现象 | 可能原因 | 解决方案 |
|-----|---------|---------|
| 404 错误 | Nginx 配置错误 | 检查配置文件 |
| 403 错误 | 文件权限问题 | 修改文件权限 |
| 页面空白 | 路径配置错误 | 重新构建，检查 homepage |
| 资源 404 | 文件未上传完整 | 重新上传 |

详细排查参考 `QUICK_START.md` 中的"故障排查"章节。

---

## 📞 支持与反馈

### 获取帮助
1. 查看文档: 优先查看 `QUICK_START.md` 和 `DEPLOYMENT_GUIDE.md`
2. 查看日志:
   - Nginx 日志: `/var/log/nginx/error.log`
   - 浏览器控制台: F12 开发者工具
3. 验证配置: 确保所有配置文件正确

### 常用命令
```bash
# 查看 Nginx 日志
sudo tail -f /var/log/nginx/error.log

# 测试 Nginx 配置
sudo nginx -t

# 重启 Nginx
sudo systemctl restart nginx

# 查看文件权限
ls -la /var/www/html/gearbox/

# 测试网络连接
curl -I http://47.111.132.236/gearbox/
```

---

## 🎉 部署完成后

系统将在以下地址可访问：

**主地址**: http://47.111.132.236/gearbox/

**集成方式**:
- 独立访问: 直接访问上述URL
- Dashboard 嵌入: 通过 Dashboard 菜单访问
- 新窗口: 可在新窗口中打开

**功能特点**:
- ✨ 齿轮箱智能选型
- 📄 技术协议自动生成（已修复闪退）
- 💰 报价单管理
- 📊 数据可视化
- 🔄 实时计算

---

## 📅 维护建议

### 定期维护
- 每月备份一次数据
- 检查日志文件大小
- 更新系统和依赖

### 更新流程
1. 备份当前版本
2. 本地测试新版本
3. 构建新版本
4. 部署到服务器
5. 验证功能
6. 清除旧备份（保留最近3个）

---

## 📝 版本信息

- **系统版本**: 1.0 (improved)
- **部署日期**: 2025-10-21
- **最后更新**: 修复技术协议模板闪退问题
- **构建版本**: 查看 `build/asset-manifest.json`

---

**准备好了吗？开始部署吧！** 🚀

首先阅读 `QUICK_START.md`，然后运行 `./deploy.sh`！
